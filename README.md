# ğŸ’HarupieceğŸ’

ê±´ê°• ì±Œë¦°ì§€ í”Œë«í¼, í•˜ë£¨ì¡°ê°

ğŸ’ [í•˜ë£¨ì¡°ê° êµ¬ê²½í•˜ê¸°](https://harupiece.com/)

## í•˜ë£¨ì¡°ê° ì†Œê°œ

- **"ì½”ë¡œë‚˜ ë•Œë¬¸ì— ëŠ˜ ë¬´ê¸°ë ¥í•œ ë‚˜, ì²´ë ¥ê³¼ ê±´ê°•ì„ ìƒê°í•´ì„œ ë­”ê°€ëŠ” í•´ì•¼ í•  ê²ƒ ê°™ì€ë°.. ì˜ì§€ë°•ì•½? ì‘ì‹¬ì‚¼ì¼?**"
- **" ì–´ë–»ê²Œ í•˜ë©´ ìŠ¤íŠ¸ë ˆìŠ¤ëŠ” ëœ ë°›ìœ¼ë©´ì„œ, ê±´ê°•í•œ ìŠµê´€ì„ ë§Œë“¤ ìˆ˜ ìˆì„ê¹Œ?"**
- í˜¹ì‹œ ì—¬ëŸ¬ë¶„ì˜ ì´ì•¼ê¸°ëŠ” ì•„ë‹Œê°€ìš”? ì´ë¥¼ ìœ„í•´ ê¸°íší•œ ê²ƒì´ ë°”ë¡œ ë°”ë¡œ !!
- **ê±´ê°•ì±Œë¦°ì§€ í”Œë«í¼ í•˜ë£¨ì¡°ê°ì…ë‹ˆë‹¤!!**

### âœ¨ ì±Œë¦°ì§€ë¥¼ í†µí•´ ì›í•˜ëŠ” ëª©í‘œì— í•œ ë°œìêµ­ ë” ë‹¤ê°€ê°ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤

> ìì‹ ì´ ì›í•˜ëŠ” ëª©í‘œì— ë§ëŠ” ì±Œë¦°ì§€ë¥¼ ì‹ ì²­í•˜ê³ , ì„œë¡œë¥¼ ì‘ì›í•˜ë‹¤ë³´ë©´ ì–´ëŠìƒˆ ëª©í‘œ ë‹¬ì„±!

### ğŸ“… ê¸°ê°„ì„ ì„¤ì •í•˜ê³  ì›í•˜ëŠ” ì±Œë¦°ì§€ë¥¼ ë§Œë“¤ìˆ˜ ìˆìŠµë‹ˆë‹¤

> ë³¸ì¸ì´ ì›í•˜ëŠ” ì±Œë¦°ì§€ê°€ ì—†ê±°ë‚˜ ê¸°ê°„ì´ ì•ˆ ë§ëŠ”ë‹¤ë©´ ì±Œë¦°ì§€ë¥¼ ë§Œë“¤ì–´ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
> ê¸°ê°„ì„ ì§§ê²Œ ì§„í–‰í•˜ì—¬ ì„±ê³µí•˜ëŠ” ìŠµê´€ë„ ê¸°ë¥¼ìˆ˜ ìˆìŠµë‹ˆë‹¤

### ğŸ’– ì‘ì›í•˜ê¸°ë¥¼ í†µí•´ ë‹¤ë¥¸ ì±Œë¦°ì €ë“¤ì—ê²Œ í˜ì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤

> ë‹¤ë¥¸ ìœ ì €ì˜ ì‘ì›ì„ í™•ì¸í•˜ë©° ë‚˜ë„ í• ìˆ˜ ìˆë‹¤ ë¼ëŠ” ìì‹ ê°ì„ ì–»ê³  ì„œë¡œ ì‘ì›í•˜ì—¬ ëª©í‘œë¥¼ ë‹¬ì„±í• ìˆ˜ ìˆìŠµë‹ˆë‹¤

### ğŸ“§ ì±„íŒ…ì„ í†µí•´ ì†Œí†µ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

> ì±„íŒ…ì„ í†µí•´ ëª©í‘œ ë‹¬ì„±ì— ê´€í•œ ê¿€íŒì´ë‚˜ ì”ì”í•œ ì†Œí†µìœ¼ë¡œ ì¹œí•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤

### ğŸ’ ì¡°ê°ì„ ëª¨ì•„ ì„±ì·¨ê°ì„ ë‹¬ì„±í•˜ì„¸ìš”

> ë‹¤ë¥¸ ìœ ì €ë¥¼ ì‘ì›í•˜ê±°ë‚˜ ì¸ì¦ìƒ·ì„ ì˜¬ë¦¬ë©´ ì¡°ê°ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤  
> ì¼ì • ì¡°ê°ì„ ëª¨ìœ¼ë©´ êµ¬ìŠ¬ë¡œ ë³€ê²½ë˜ë©°, êµ¬ìŠ¬ì„ ëª¨ìœ¼ëŠ” ì¬ë¯¸ì— ì±Œë¦°ì§€ë¥¼ ë” ì—´ì‹¬íˆ í•˜ê²Œ ë©ë‹ˆë‹¤

## ê°œìš”

### â°ê°œë°œê¸°ê°„

2021ë…„ 07ì›” 23ì¼ ~ 2021ë…„ 08ì›” 31ì¼

### âš™ ê¸°ìˆ ìŠ¤íƒ

### Language : <img alt="JavaScript" src ="https://img.shields.io/badge/JavaScript-F7DF1E.svg?&style=for-the-appveyor&logo=JavaScript&logoColor=white"/>

### AWS : <img alt="Amazon S3" src ="https://img.shields.io/badge/Amazon S3-569A31.svg?&style=for-the-appveyor&logo=Amazon S3&logoColor=white"/>

### Front : <img alt="React" src ="https://img.shields.io/badge/React-61DAFB.svg?&style=for-the-appveyor&logo=React&logoColor=white"/> , <img alt="Redux" src ="https://img.shields.io/badge/Redux-764ABC.svg?&style=for-the-appveyor&logo=Redux&logoColor=white"/> , <img alt="styled-components" src ="https://img.shields.io/badge/styled_components-DB7093.svg?&style=for-the-appveyor&logo=styled-components&logoColor=white"/> , <img alt="axios" src ="https://img.shields.io/badge/axios-764ABC.svg?&style=for-the-appveyor&logo=axios&logoColor=white"/>

### ğŸ‘¨â€ğŸ‘¨â€ğŸ‘§â€ğŸ‘§ íŒ€ì›

Front-end: ê¹€íƒœí˜„ ì •ë¯¼ì£¼ í¸ì›ì¤€  
Back-end: ê¹€ì„ ìš© ê¹€ì§„íƒœ ë°•ì—°ìš° ìµœì™•ê·œ
Dedigner: ì•ˆì§€í˜œ ìœ ìˆ˜ë¹ˆ

ğŸ“º [ìœ íŠœë¸Œ ë§í¬]()

ğŸ“š [ë°±ì—”ë“œ Repository](https://github.com/OneDayPiece/server)

ğŸ“ [íŒ€ ë…¸ì…˜](https://pinnate-whimsey-d2c.notion.site/b4cb15aad252413c9cad64877dba3719)

<<<<<<< HEAD
---
=======
## ğŸ› ì£¼ìš”ê¸°ëŠ¥
### ëœë”© í˜ì´ì§€
<img src="https://i.ibb.co/J7HfZ5z/image.gif" width="" height="400px" title="px(í”½ì…€) í¬ê¸° ì„¤ì •" alt="landingPage"></img><br/>
### ì±Œë¦°ì§€ ê°œì„¤í•˜ê¸°
<img src="https://i.ibb.co/Qrpv0zV/image.gif" width="" height="400px" title="px(í”½ì…€) í¬ê¸° ì„¤ì •" alt="CreateChallenge"></img><br/>
### ì±Œë¦°ì§€ ì°¸ì—¬í•˜ê¸°
<img src="https://i.ibb.co/LkvyvfG/image.gif" width="" height="400px" title="px(í”½ì…€) í¬ê¸° ì„¤ì •" alt="JoinChallenge"></img><br/>
### ì±Œë¦°ì§€ ì¸ì¦í•˜ê¸°
<img src="https://i.ibb.co/cy8QrXs/image.gif" width="" height="400px" title="px(í”½ì…€) í¬ê¸° ì„¤ì •" alt="CertificationChallenge"></img><br/>
### ì±Œë¦°ì§€ ê²€ìƒ‰í•˜ê¸°
<img src="https://i.ibb.co/SRF4MGV/image.gif" width="" height="400px" title="px(í”½ì…€) í¬ê¸° ì„¤ì •" alt="SearchChallenge"></img><br/>
>>>>>>> 20a6c3ef4b69b64ee24faddbb6f2777e4fb54c48

## ğŸš€íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

### ğŸ”ê²€ìƒ‰

ì²˜ìŒ ê²€ìƒ‰ ê¸°ëŠ¥ì„ êµ¬í˜„í•  ë‹¹ì‹œ ì „ì²´ ì±Œë¦°ì§€ê°€ ë§¤ìš° ì ì—ˆê¸°ì—

ì„œë²„ë¡œë¶€í„° ëª¨ë“  ì±Œë¦°ì§€ë¥¼ ë¶ˆëŸ¬ì˜¨ ë’¤ í”„ë¡ íŠ¸ì—ì„œ ëˆŒë ¤ì§„ íƒœê·¸ì— ë§ê²Œ í•„í„°ë§ í•´ì£¼ëŠ” í•¨ìˆ˜ë¥¼ êµ¬í˜„

```javascript
// ì„œë²„ë¡œë¶€í„° ë°›ì•„ì˜¤ëŠ” challengesì™€ ì‚¬ìš©ìê°€ ëˆ„ë¥¸ íƒœê·¸ ê°’ filtersë¥¼ ë¹„êµí•˜ëŠ” í•¨ìˆ˜
const multiPropsFilter = (challenges, filters) => {
  const filterKeys = Object.keys(filters);
  return challenges.search.filter((challenge) => {
    return filterKeys.every((key) => {
      if (!filters[key].length) return true;
      if (Array.isArray(challenge[key])) {
        return challenge[key].some((keyEle) => filters[key].includes(keyEle));
      }
      return filters[key].includes(challenge[key]);
    });
  });
};
const searchProducts = () => {
  const filteredProducts = multiPropsFilter(searchList, filteredCollected());
  return filteredProducts?.filter((product) => {
    return product;
  });
};
```

í•˜ì§€ë§Œ ì ì  ì±Œë¦°ì§€ê°€ ë§ì•„ì§ˆìˆ˜ë¡ ì„œë²„ë¡œë¶€í„° ì „ì²´ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ëŠ”ê²Œ ë¹„íš¨ìœ¨ì ì´ë¼ê³  íŒë‹¨í•˜ì—
íƒœê·¸ë¥¼ ëˆ„ë¥¸ ë’¤ ê²€ìƒ‰ ë²„íŠ¼ì„ ëˆ„ë¥¼ë•Œ í•´ë‹¹ ë°ì´í„°ë¥¼ ì„œë²„ë¡œë¶€í„° í˜¸ì¶œí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½ ì‹œë„

```javascript
// ì‚¬ìš©ìê°€ ëˆ„ë¥¸ íƒœê·¸ ê°’ì„ collectedTrueKeysì— ë‹´ì•„ ì„œë²„ë¡œ ì „ì†¡
 const collectedTrueKeys = {
      categoryName: "",
      tags: "",
      challengeProgress: "",
    };
    const { categoryName, tags, progress } = searchState.passingTags;
    for (let categoryKey in categoryName) {
      if (categoryName[categoryKey])
        collectedTrueKeys.categoryName = categoryKey;
    }
    for (let tagKey in tags) {
      if (tags[tagKey]) collectedTrueKeys.tags = tagKey;
    }
    for (let progressKey in progress) {
      if (progress[progressKey]) collectedTrueKeys.progress = progressKey;
    }
    return collectedTrueKeys;
  };
  const filter = () => {
    dispatch(searchAll.searchFilterDB(filteredCollected()));
  };
```

ë§Œë“¤ë©´ì„œë„ íƒœê·¸ë¥¼ ëˆ„ë¥¼ë•Œ ë°”ë¡œ í•´ë‹¹ ë°ì´í„°ë¥¼ í˜¸ì¶œí•˜ëŠ” ë°©ì‹ì´ ë” í¸í•˜ì§€ì•Šì„ê¹Œí–ˆì—ˆëŠ”ë° ì•„ë‹ˆë‚˜ ë‹¤ë¥¼ê¹Œ ìœ ì € í”¼ë“œë°±ìœ¼ë¡œ ë“¤ì–´ì™€ì„œ ë°”ë¡œ ìˆ˜ì • ì‹œë„
ê¸°ì¡´ì—ëŠ” ê²€ìƒ‰í•˜ê¸° ë²„íŠ¼ì„ í†µí•´ apië¥¼ í˜¸ì¶œí–ˆìœ¼ë‚˜
íƒœê·¸ì˜ ìƒíƒœê°’ì„ ë°”ê¾¸ëŠ” í•¨ìˆ˜(allFilterClickListener)ì•ˆì—ì„œ ì‹¤í–‰ì‹œí‚¤ë ¤í•˜ë‹ˆ íƒœê·¸ì˜ ìƒíƒœê°’ì´ ë³€í•˜ê¸°ì „ì— apië¥¼ í˜¸ì¶œí•´ì„œ ì‹¤íŒ¨

```javascript
const allFilterClickListener = (e, filterProp) => {
    let name = e.target.textContent;
    if (name === "ê¸ˆì—°ê¸ˆì£¼") {
      name = "NODRINKNOSMOKE";
    } else if (name === "ìš´ë™") {
      name = "EXERCISE";
    } else if (name === "ìƒí™œì±Œë¦°ì§€") {
      name = "LIVINGHABITS";
    }
      ...

      else {
      name = e.target.textContent;
    }
    setSearchState({
      passingTags: {
        ...searchState.passingTags,
        [filterProp]: {
          [name]: !searchState.passingTags[filterProp][name],
        },
      },
    });
  };

  useEffect(() => {
    if (keyWord === "ALL") {
      dispatch(searchActions.searchFilterDB(filteredCategory(), keyWord));
    } else {
      return dispatch(
        searchActions.searchFilterDB(filteredCategory(), keyWord)
      );
    }
  }, [dispatch, filteredCategory, keyWord, searchState]);
```

useEffectì„ í™œìš©í•˜ì—¬ íƒœê·¸ë¥¼ ëˆŒëŸ¬ ìƒíƒœê°’ì´ ë°”ë€”ë•Œë§ˆë‹¤ ë°”ë¡œ apië¥¼ í˜¸ì¶œì‹œí‚¤ëŠ” ë°©ì‹ìœ¼ë¡œ í•´ê²°

### ğŸªrefresh token

ë¡œê·¸ì¸ì‹œ ë°›ì•„ì˜¤ëŠ” accessTokenì´ ë§Œë£Œë˜ì—ˆì„ë•Œ ê°™ì´ ë°›ì•„ì˜¨ refreshTokenì„ ì„œë²„ì— ì „ì†¡í•˜ê³ 
ìƒˆë¡œìš´ accessTokenê³¼ refreshTokenì„ ê°€ì ¸ì™€ ì¿ í‚¤ì— ì €ì¥í•˜ëŠ” ë°©ì‹ì„ êµ¬í˜„

```javascript
instance.interceptors.response.use(
  (response) => {
    return response;
  },
  async (error) => {
    const {
      config,
      response: { status },
    } = error;
    if (status === 401) {
      if (error.response.data.message === "TokenExpiredError") {
        const originalRequest = config;
        const refresh_token = getCookie("refreshToken");
        const token = getCookie("token");
        const { data } = await instance.post(`api/member/reissue`, {
          accessToken: token,
          refreshToken: refresh_token,
        });
        const { accessToken, refreshToken } = data;
        const accessCookie = { name: "token", value: accessToken };
        const refreshCookie = { name: "refreshToken", value: refreshToken };
        await multiCookie(accessCookie, refreshCookie);
        instance.defaults.headers.common[
          "Authorization"
        ] = `Bearer ${accessToken}`;
        originalRequest.headers.common[
          "Authorization"
        ] = `Bearer ${accessToken}`;
        return instance(originalRequest);
      }
    }
  }
);
```

1. 401ì—ëŸ¬ë¥¼ interceptorë¥¼ í™œìš©í•´í•˜ì—¬ ì²˜ë¦¬í–ˆìœ¼ë‚˜ ê¸°ì¡´ì— ì—ëŸ¬ê°€ ë‚œ apiìš”ì²­ì„ ë‹¤ì‹œ í•˜ëŠ” ë¡œì§ì´ ì—†ì—ˆê³ ,
2. í† í°ì´ ë§Œë£Œëœ ìƒíƒœë¡œ ì—¬ëŸ¬ ì¢…ë¥˜ì˜ apië¥¼ ë™ì‹œ í˜¸ì¶œí• ë•Œ í˜¸ì¶œëœ ëª¨ë“  apië§ˆë‹¤ ìœ„ì— ë¡œì§ì´ ì‹¤í–‰ë˜ì–´ í•œë²ˆì— í† í° êµì²´ê°€ ì—¬ëŸ¬ë²ˆ ì¼ì–´ë‚¨
3. ë˜í•œ ë¡œê·¸ì¸ì‹œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜(ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ ì˜¤ë¥˜ ë“±) ë˜í•œ 401ì—ëŸ¬ì—¬ì„œ í•´ë‹¹ ì˜¤ë¥˜ ë°œìƒì‹œ ê¸°ì¡´ì— ì •í•´ë‘” ì—ëŸ¬ì²˜ë¦¬ê°€ ë™ì‘í•˜ì§€ ì•ŠìŒ.

```javascript
let isTokenRefreshing = false;
let refreshSubscribers = [];
const onTokenRefreshed = (accessToken) => {
  refreshSubscribers.map((callback, idx) => {
    return callback(accessToken);
  });
};
const addRefreshSubscriber = (callback) => {
  refreshSubscribers.push(callback);
};
...
instance.interceptors.response.use(
  (res) => {
    return res;
  },
  async (err) => {
    const originalConfig = err.config;
    if (originalConfig.url !== "api/member/login" && err.response) {
      if (err.response.status === 401 && !originalConfig._retry) {
        originalConfig._retry = true;
        if (!isTokenRefreshing) {
          isTokenRefreshing = true;
          const rs = await refreshTokens();
          const { accessToken, refreshToken } = rs.data;
          setCookie("token", accessToken);
          setCookie("refreshToken", refreshToken);
          isTokenRefreshing = false;
          instance.defaults.headers.common.Authorization = ` Bearer ${accessToken}`;
          originalConfig.headers.Authorization = `Bearer ${accessToken}`;
          onTokenRefreshed(accessToken);
          refreshSubscribers = [];
          return instance(originalConfig);
        }
        const retryOriginalRequest = new Promise((resolve) => {
          addRefreshSubscriber((accessToken) => {
            originalConfig.headers.Authorization = "Bearer " + accessToken;
            resolve(instance(originalConfig));
          });
        });
        return retryOriginalRequest;
      }
      if (err.response.status === 403 && err.response.data) {
        return Promise.reject(err.response.data);
      }
    }
    return Promise.reject(err);
  }
);
```

1 & 2. ì—¬ëŸ¬ ì¢…ë¥˜ì˜ apië¥¼ ë™ì‹œ í˜¸ì¶œí•˜ì—¬ ë°œìƒí•œ ì—ëŸ¬ë“¤ì„
let refreshSubscribers = []; ì•ˆì— ë‹´ì•„ë‘ê³  ì°¨ë¡€ë¡œ ì‹¤í–‰ì‹œí‚´ìœ¼ë¡œ
ì—ëŸ¬ê°€ ë‚œ api ìš”ì²­ì„ í•˜ë‚˜ë§Œ ì²˜ë¦¬ ì‹¤í–‰í•˜ê³  accessTokenì„ êµì²´í•œ ë’¤
ë‚˜ë¨¸ì§€ api ìš”ì²­ì„ ì‹¤í–‰í•˜ëŠ”ê²ƒìœ¼ë¡œ í•´ê²° 3. ë¡œê·¸ì¸ì‹œ ë°œìƒí•˜ëŠ” 401 ì—ëŸ¬ëŠ” if (originalConfig.url !== "api/member/login" && err.response)ìœ¼ë¡œ ì˜ˆì™¸ ì²˜ë¦¬í•¨

### ì±„íŒ… ë¬´í•œìŠ¤í¬ë¡¤

```javascript
//ChatInfinityScroll.js
const _handleScroll = _.throttle(() => {
  //ë¡œë”©ì¤‘ì´ë©´ callNext()ë¥¼ ì•ˆë¶€ë¥´ë„ë¡
  if (loading) {
    return;
  }

  if (scrollTo.current.scrollTop === 0) {
    setPrevHeight(scrollTo.current.scrollHeight);
    console.log(scrollTo.current.scrollHeight);
    callNext();
  }
}, 500);

//MessageList.js
useEffect(() => {
  if (prevHeight) {
    scrollTo.current.scrollTop = scrollTo.current.scrollHeight - prevHeight;
    console.log(prevHeight, scrollTo.current.scrollHeight);
    return setPrevHeight(null);
  } else {
    scrollTo.current.scrollTop =
      scrollTo.current.scrollHeight - scrollTo.current.clientHeight;
  }
}, [chatInfo.messages]);
```

1. ì±„íŒ…ê¸°ëŠ¥ êµ¬í˜„ ì´ˆë°˜ì— ìœ ì €ê°€ ë©”ì„¸ì§€ë¥¼ ì…ë ¥í•  ë•Œë§ˆë‹¤ ìŠ¤í¬ë¡¤ì„ ì œì¼ í•˜ë‹¨ì— ìœ„ì¹˜í•˜ë„ë¡ ì½”ë“œ êµ¬í˜„

2. useEffectì˜ ì˜ì¡´ ë°°ì—´ì„ `chatInfo.messages` ì„¤ì •í•´ì„œ **InfinityScroll** í†µí•´ ìƒˆë¡œìš´ ë©”ì„¸ì§€
   ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ê²½ìš°ë„ `chatInfo.messages`ê°€ ì—…ë°ì´íŠ¸ ë˜ë¯€ë¡œ useEffect ì‹¤í–‰ë˜ë©´ì„œ ìŠ¤í¬ë¡¤ ì œì¼
   í•˜ë‹¨ìœ¼ë¡œ ì´ë™

3. api ìš”ì²­í•˜ê¸°ì „ì˜ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¥¼ **`preHeight`** ë³€ìˆ˜ì— í• ë‹¹

4. **`preHeight`** ê°€ ìˆëŠ” ê²½ìš° ìŠ¤í¬ë¡¤ì´ í•˜ë‹¨ìœ¼ë¡œ ë‚´ë ¤ê°€ì§€ê³  ì•Šê³  ì €ì¥ë˜ì–´ ìˆëŠ” ìœ„ì¹˜ì— ìˆë„ë¡
   useEffect ì½”ë“œ ë³€ê²½
